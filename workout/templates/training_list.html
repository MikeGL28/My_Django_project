{% extends "base.html" %}
{% block title %}–ú–æ–∏ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ üí™{% endblock %}

{% block body %}

<div class="container mt-5">
  <h1>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ üí™</h1>

  <div class="about-section d-flex flex-wrap align-items-center mb-4">
    <!-- –û–ø–∏—Å–∞–Ω–∏–µ -->
    <div class="col-md-6 col-12 pe-md-4">
      <p>
        <strong>–¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞, –∞ —Å–ø–æ—Å–æ–± –¥–µ—Ä–∂–∞—Ç—å —Å–µ–±—è –≤ —Ñ–æ—Ä–º–µ,</strong><br>
        —Ä–∞–∑–≤–∏–≤–∞—Ç—å –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç—å –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å –Ω–æ–≤—ã—Ö —Ü–µ–ª–µ–π. –î–ª—è –º–µ–Ω—è —Å–ø–æ—Ä—Ç —Å—Ç–∞–ª –Ω–µ–æ—Ç—ä–µ–º–ª–µ–º–æ–π —á–∞—Å—Ç—å—é –∂–∏–∑–Ω–∏.
        –û–Ω –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Ç—å –±–æ–ª–µ–µ —ç–Ω–µ—Ä–≥–∏—á–Ω—ã–º, —É–≤–µ—Ä–µ–Ω–Ω—ã–º –∏ –º–æ—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≤ –¥—Ä—É–≥–∏—Ö –∞—Å–ø–µ–∫—Ç–∞—Ö.
      </p>

      <p>
        –ó–¥–µ—Å—å —è –≤–µ–¥—É —É—á—ë—Ç —Å–≤–æ–∏—Ö –∑–∞–Ω—è—Ç–∏–π, —á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∏ –æ–¥–Ω–æ–≥–æ –¥–Ω—è –∏ —Å–ª–µ–¥–∏—Ç—å –∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º.
        –û—Ç –ø—Ä–æ—Å—Ç—ã—Ö –æ—Ç–∂–∏–º–∞–Ω–∏–π –¥–æ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã—Ö –∫–∞—Ä–¥–∏–æ-—Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ ‚Äî –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç –º–µ–Ω—è –∫ –º–æ–∏–º —Ü–µ–ª—è–º.
      </p>

      <h4>–ö–∞–∫ —è —Ç—Ä–µ–Ω–∏—Ä—É—é—Å—å?</h4>
      <p>
        –Ø —Ñ–∞–Ω–∞—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è: —Ç—è–≥–∞ –∫ —Ç—É—Ä–Ω–∏–∫—É, —Ä–∞–±–æ—Ç–∞ –Ω–∞ –±—Ä—É—Å—å—è—Ö, —Å–∏–ª–æ–≤—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∏ –¥–∞–∂–µ –±–µ–≥ –¥–ª—è –≤—ã–Ω–æ—Å–ª–∏–≤–æ—Å—Ç–∏.
        –ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –Ω–∞–π–¥—ë—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –∫–∞–∂–¥–æ–º—É —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—é –∏ —Å–º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å–ª–µ–¥–∏—Ç—å, –∫–∞–∫ —è —Ä–æ—Å —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º.
      </p>
      <p class="lead mt-3">
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ–π –º–∏—Ä —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ üí™<br>
        –ö–∞–∂–¥—ã–π –≥—Ä–∞—Ñ–∏–∫ –∑–¥–µ—Å—å ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —Å–æ–±–æ–π!
      </p>
    </div>

    <!-- –§–æ—Ç–æ -->
    <div class="col-md-6 col-12 d-flex justify-content-center mt-3 mt-md-0">
      <img src="/media/workout/—Ñ–æ—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞.jpg" alt="–§–æ—Ç–æ —Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏" class="img-fluid rounded shadow-sm" style="max-width: 300px;">
    </div>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫–∏ -->
  <h2 class="mt-5">üìä –ü—Ä–æ–≥—Ä–µ—Å—Å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫</h2>
  <div class="row g-4">
    <div class="col-md-6">
      <div class="grafana-card">
        {% if pull_ups_chart %}
          {{ pull_ups_chart|safe }}
        {% else %}
          <p class="text-center my-5 text-muted">üèãÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ–¥—Ç—è–≥–∏–≤–∞–Ω–∏–π.</p>
        {% endif %}
      </div>
    </div>

    <div class="col-md-6">
      <div class="grafana-card">
        {% if dips_chart %}
          {{ dips_chart|safe }}
        {% else %}
          <p class="text-center my-5 text-muted">ü™µ –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—Ä—É—Å—å–µ–≤.</p>
        {% endif %}
      </div>
    </div>

    <div class="col-md-6">
      <div class="grafana-card">
        {% if push_ups_chart %}
          {{ push_ups_chart|safe }}
        {% else %}
          <p class="text-center my-5 text-muted">üñêÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–∂–∏–º–∞–Ω–∏–π.</p>
        {% endif %}
      </div>
    </div>

    <div class="col-md-6">
      <div class="grafana-card">
        {% if run_chart %}
          {{ run_chart|safe }}
        {% else %}
          <p class="text-center my-5 text-muted">üèÉ‚Äç‚ôÇÔ∏è –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–µ–≥–∞.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
  <h2 class="mt-5">üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ üí™</h2>
  <div class="calendar">
    <div class="calendar-header">
      {{ month_name|title }} {{ now.year }}
    </div>
    <div class="calendar-grid">
      {% for day in calendar %}
        <div class="day-cell level-{{ day.level }}" title="{{ day.day }} {{ month_name }}: {{ day.status }}">
          {{ day.day }}
        </div>
      {% endfor %}
    </div>
    <div class="calendar-legend mt-3">
      <span class="legend-item level-0">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</span>
      <span class="legend-item level-1">–ù–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–ª—Å—è</span>
      <span class="legend-item level-2">–õ—ë–≥–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
      <span class="legend-item level-3">–•–æ—Ä–æ—à–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
      <span class="legend-item level-4">–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞</span>
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
  <div class="actions mt-4">
    <a href="{% url 'workout:add_training' %}" class="btn btn-primary btn-lg">–î–æ–±–∞–≤–∏—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</a>
  </div>
</div>

<style>
  body {
    font-family: Arial, sans-serif;
    background-image: url('/static/css/—Ñ–æ–Ω —Ç—É—Ä–Ω–∏–∫.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    background-attachment: fixed;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    color: #fff;
    position: relative;
  }

  /* –¢–µ–º–Ω—ã–π –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Å–ª–æ–π –ø–æ–≤–µ—Ä—Ö —Ñ–æ–Ω–∞ */
  body::before {
    content: "";
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    z-index: -1;
  }

  .container,
  .about-section,
  .calendar,
  .actions {
    background-color: rgba(255, 255, 255, 0.05); /* –õ—ë–≥–∫–∏–π –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
    backdrop-filter: blur(5px);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    color: #ffffff !important;
  }

  h1, h2 {
    color: #ffffff;
    text-shadow: 0 0 5px #000;
  }

  p {
    color: #f8f8f8;
    font-size: 1rem;
  }

  .photo-container img {
    max-width: 60%;
    border-radius: 10px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5);
  }

  .grafana-card {
    background-color: rgba(30, 30, 30, 0.95);
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    padding: 1rem;
    height: 100%;
  }

  .plotly-graph-div {
    width: 100%;
    height: 350px !important;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif !important;
  }

  .plotly .hoverlabel {
    background-color: #222222 !important;
    border: none !important;
    font-size: 14px !important;
  }

  .calendar {
    margin-top: 30px;
  }

  .calendar-header {
    font-weight: bold;
    font-size: 1.25rem;
    color: #ffffff;
    text-shadow: 0 0 5px #000;
  }

  .calendar-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 8px;
    max-width: 500px;
    margin-bottom: 10px;
  }

  .day-cell {
    width: 30px;
    height: 30px;
    background-color: #ebedf0;
    border-radius: 6px;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: transform 0.2s ease;
    color: #333;
    font-weight: bold;
  }

  .day-cell:hover {
    transform: scale(1.1);
    z-index: 1;
  }

  /* –¶–≤–µ—Ç–∞ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏ */
  .day-cell.level-0 { background-color: #aaaaaa; }
  .day-cell.level-1 { background-color: #ffcccc; }
  .day-cell.level-2 { background-color: #ffb3b3; }
  .day-cell.level-3 { background-color: #ff4d4d; }
  .day-cell.level-4 { background-color: #cc0000; }

  .calendar-legend {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    font-size: 0.9rem;
    color: #ccc;
  }

  .legend-item.level-0::before,
  .legend-item.level-1::before,
  .legend-item.level-2::before,
  .legend-item.level-3::before,
  .legend-item.level-4::before {
    content: "";
    display: inline-block;
    width: 16px;
    height: 16px;
    margin-right: 4px;
    border-radius: 4px;
  }

  .legend-item.level-0::before { background-color: #aaaaaa; }
  .legend-item.level-1::before { background-color: #ffcccc; }
  .legend-item.level-2::before { background-color: #ffb3b3; }
  .legend-item.level-3::before { background-color: #ff4d4d; }
  .legend-item.level-4::before { background-color: #cc0000; }

  .btn-primary {
    background-color: #cc0000;
    border: none;
    color: #000;
    font-weight: bold;
  }

  .btn-primary:hover {
    background-color: green;
    color: #000;
  }
  footer {
      background-color: transparent;
      color: #fff;
      text-align: center;
      padding: 10px 20px;
      border-top: 0px solid #ddd; /* –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å–Ω—É—é –ª–∏–Ω–∏—é */
  }

  footer p {
      margin: 0;
      font-size: 14px;
  }
</style>
{% block extra_styles %}
<style>
  /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–≤–µ—Ç–ª–æ–≥–æ navbar —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ */
  .navbar {
    background-color: #ffffff !important;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
  }

  .navbar .navbar-brand,
  .navbar .nav-link,
  .navbar .dropdown-item,
  .navbar .dropdown-toggle {
    color: #000 !important;
    font-weight: 500;
  }

  .navbar-toggler-icon {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(0,0,0,0.7)' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E") !important;
  }

  .dropdown-menu {
    background-color: #fff !important;
    border: none !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1) !important;
  }

  .dropdown-item:hover,
  .dropdown-item:focus {
    background-color: #f1f1f1 !important;
    color: #000 !important;
  }

  .btn-white-custom {
    color: #000 !important;
    border: none;
    font-weight: 500;
  }

  .btn-white-custom:hover,
  .btn-white-custom:focus {
    background-color: #f1f1f1;
    color: #000 !important;
  }

  .navbar-toggler-icon {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg viewBox='0 0 30 30' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath stroke='rgba(0,0,0,0.5)' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3E%3C/svg%3E");
  }

  .navbar-toggler {
    border-color: rgba(0, 0, 0, 0.5);
  }
  .footer-text {
    font-size: 0.9rem;
    color: #ccc;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
  }
</style>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
    window.dispatchEvent(new Event('resize'));
  });
</script>
<script>
  function animatePlotLine(iframe, delay) {
    return new Promise((resolve) => {
      const checkPlotly = setInterval(() => {
        const chartWindow = iframe.contentWindow;
        if (chartWindow && chartWindow.Plotly && chartWindow.document.querySelector('.js-plotly-plot')) {
          clearInterval(checkPlotly);

          const gd = chartWindow.document.querySelector('.js-plotly-plot');
          if (!gd || !gd._fullLayout) {
            resolve();
            return;
          }

          const originalData = JSON.parse(JSON.stringify(gd.data));
          const zeroData = originalData.map(trace => ({
            ...trace,
            y: Array(trace.y.length).fill(0)
          }));

          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω—É–ª–µ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
          chartWindow.Plotly.react(gd, zeroData, gd.layout);

          setTimeout(() => {
            chartWindow.Plotly.restyle(gd, { y: [Array(trace.y.length).fill(0)] }, [0]);
          }, 150);
              { data: originalData },
              {
                duration: 800,
                transition: { duration: 600, easing: 'easeOutElastic' },
                frame: { duration: 50, redraw: false }
              }
            );
            resolve();
          }, delay);
        }
      }, 100);
    });
  }

  window.addEventListener('DOMContentLoaded', async () => {
    const iframes = document.querySelectorAll('.plotly-graph-div iframe');

    let delay = 0;
    const delayStep = 300; // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∞–Ω–∏–º–∞—Ü–∏—è–º–∏ –≥—Ä–∞—Ñ–∏–∫–æ–≤

    for (const iframe of iframes) {
      await animatePlotLine(iframe, delay);
      delay += delayStep;
    }
  });
</script>
{% endblock %}

{% endblock %}